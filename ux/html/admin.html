<!-- 
admin.html
Creado por Iván Romero Ruiz 
Modificado: 3/12/19
-->

<!DOCTYPE html>
<html lang="es">

<head>
    <script type="text/javascript" src="../js/PROXY.js"></script>
    <script type="text/javascript" src="../js/instascan.min.js"></script>
    <script type="text/javascript" src="../js/QR-anyadir-sensor.js"></script>

    <script type="text/javascript" src="../js/barra-busqueda.js"></script>
    <!-- Scripts para API Google Maps -->
    <script src="../js/logicaAdministracion.js"></script>

    <!-- Scripts para API Google Maps -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBwukBpX9SUI57LEeMhlQ-BlDfC2LeS2K8&callback=initMap&libraries=visualization" type="text/javascript"></script>
    <script type="text/javascript" src="../js/mapAdmin.js"></script>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://unpkg.com/gijgo@1.9.13/js/gijgo.min.js" type="text/javascript"></script>
    <link href="https://unpkg.com/gijgo@1.9.13/css/gijgo.min.css" rel="stylesheet" type="text/css" />

    <script type="text/javascript">
        // Declaracion de variables
        var proxy = new Proxy();
        //Para el local
        var direccion = "http://localhost:8080";
        //Para el plesk
        //var direccion = "https://juconol.upv.edu.es";
        var sensores;
        var unSensor // Sensor clicado

        var usuarios;
        var unUsuario; // Usuario clicado

        var numeroTotalDeUsuarios;

        var primeraLlamadaA_rellenarTarjetasNumeroSensores = true; // Se utiliza para borrar previamente el texto con los numeros que hay en las tarjetas si no es la primera vez que se llama a rellenarTarjetasNumeroSensores, si esto no se hiciera no se visualizarian los numeros

        var ul;

        var hayAlgunElementoSeleccionado = false; // Para saber si hay algun elemento seleccionado y poder cambiar su color o borrarlo

        var elementoSeleccionado; // Se utiliza para cambiar el color del elemento seleccionado

        var innerHTMLDetarjetaExtra; // Para guardar el contenido de la tarjeta4 antes de borrarla al cambiar al modo usuarios

        var innerHTMLTarjetaINFORMACION; // Para vaciarlo cuando cambiemos de modo o borramos sensor/usuario. Se rellena en llamadaAgetSensoresYSusUsuariosYARellenarTarjetasNumeroSensores porque se llama al principio

        var modoActual = 0; // 0 si el modo actual es SENSORES y 1 si es USUARIOS

        var mostrandoErrores = false; // False si no esta seleccionado el boton que muestra los nodos que dan lecturas erroneas, true si SI

        // Fecha actual
        var hoy00;
        var hoy24;

        // VARIABLES INTERFAZ

        // Imagenes
        var icono1;
        var icono2;
        var icono3;

        // Modal
        var botonModal;
        var textoModal;

        // Tarjetas superiores
        var numeroSensores;
        var sensoresActivos;
        var sensoresInactivos;
        var sensoresEnStock;
        var contenedorSensoresEnStock;
        var textoTarjeta1;
        var textoTarjeta2;
        var textoTarjeta3;

        // Modos
        var botonSensores;
        var botonUsuarios;

        // Tarjeta SENSORES / USUARIOS
        var textoSENSORESyUSUARIOS;

        var botonError;
        var iconoError;
        var iconoAdd;
        var iconoAddInnerHTML;
        var iconoCanInnerHTML;
        var botonBorrar;

        var textoColumna1;
        var textoColumna2;
        var textoColumna3;
        var textoColumna4;

        // Pulso
        var pulse1;
        var pulse2;

        // Tarjeta INFORMACION
        var tarjetaINFORMACION;
        var iconoDesvincular;
        var iconoDesvincularInnerHTML;

        // Mapa 
        var arrayMarcadores = [];
        var heatmap;

        // Fin declaracion de variables

        // Llamar a checkCookies antes de que se cargue el cuerpo para que no se pueda acceder a la pagina sin estar logineado
        window.addEventListener('load', checkCookie, false);

        // Se llama a llamadaAgetSensoresYSusUsuariosYARellenarTarjetasNumeroSensores cuando se crea la ventana
        window.addEventListener('load', llamadaAgetSensoresYSusUsuariosYARellenarTarjetasNumeroSensores, false);

        // Llamada al crearse la pagina para rellenar la lista de sensores mediante una llamada interna a la funcion crearSensorLista() para cada elemento
        // Tambien llama a la funcion que escribe el numero de sensores de las 4 tarjetas ya que necesita la variable sensores que se rellena aqui
        // Ademas se llama a la creacion del mapa para que no se haga antes de las cookies y se inicializan variables en relacion con la interfaz
        function llamadaAgetSensoresYSusUsuariosYARellenarTarjetasNumeroSensores() {
            proxy.getSensoresYSusUsuarios(function(resp) {

                sensores = resp;

                console.log("Numero de sensores: " + resp.length);
                console.log("Primer sensor " + sensores[0]);
                console.log("Adios " + 1);

                for (var i = 0; i < sensores.length; i++) {
                    crearSensorLista(i);
                }

                // Mostrar numero de sensores
                rellenarTarjetasNumeroSensores();

            });

            // Puntos del mapa de hoy
            var date = new Date();
            var diaHoyMilisegundos = date.getTime();
            hoy00 = diaHoyMilisegundos - (diaHoyMilisegundos % 86400000); // Un dia tiene 86400000 milisegundos
            hoy24 = hoy00 + (86400000 - 100000); // Mismo dia a las 23:59:59
            var date = new Date();
            var fecha = document.getElementById("datepicker").value = (date.getMonth() + 1) + "/" + date.getDate() + "/" + date.getFullYear();

            recibirMedidasFecha({
                "desde": hoy00,
                "hasta": hoy24
            });

            //ELEMENTOS DE LA INTERFAZ
            icono1 = document.getElementById("icono1");
            icono2 = document.getElementById("icono2");
            icono3 = document.getElementById("icono3");

            botonModal = document.getElementById("botonModal");
            textoModal = document.getElementById("textoModal");

            numeroSensores = document.getElementById("valorTarjeta1");
            sensoresActivos = document.getElementById("valorTarjeta2");
            sensoresInactivos = document.getElementById("valorTarjeta3");
            sensoresEnStock = document.getElementById("valorTarjeta4");
            contenedorSensoresEnStock = document.getElementById("tarjeta4");
            numeroUsuarios = document.getElementById("valorTarjeta1");
            usuariosNormales = document.getElementById("valorTarjeta2");
            usuariosConductores = document.getElementById("valorTarjeta3");
            tarjetaEliminada = document.getElementById("valorTarjeta4");

            botonSensores = document.getElementById('modoSensores');
            botonUsuarios = document.getElementById('modoUsuarios');

            textoTarjeta1 = document.getElementById("textoTarjeta1");
            textoTarjeta2 = document.getElementById("textoTarjeta2");
            textoTarjeta3 = document.getElementById("textoTarjeta3");
            tarjeta4 = document.getElementById("tarjeta4");

            textoSENSORESyUSUARIOS = document.getElementById("textoSensores");

            ul = document.getElementById("lista");

            botonError = document.getElementById("botonError");
            iconoError = document.getElementById("iconoError");
            iconoAdd = document.getElementById("botonAdd");
            iconoCan = document.getElementById("botonCan");

            textoColumna1 = document.getElementById("textoColumna1");
            textoColumna2 = document.getElementById("textoColumna2");
            textoColumna3 = document.getElementById("textoColumna3");
            textoColumna4 = document.getElementById("textoColumna4");

            tarjetaINFORMACION = document.getElementById("informacionUsuario");
            iconoDesvincular = document.getElementById("iconoDesvincular");

            pulse1 = document.getElementById("pulse1");
            pulse2 = document.getElementById("pulse2");

            if (primeraLlamadaA_rellenarTarjetasNumeroSensores == true) { // Se guarda la estructura de la tarjeta informacion cuando se llama por primera vez para vaciarla posteriormente
                innerHTMLTarjetaINFORMACION = document.getElementById("informacionUsuario").innerHTML;
            }

        }

        // Funcion que crea un numero de elementos en la lista equivalente al numero total de sensores en la base de datos
        function crearSensorLista(i) {

            var maxListaSensores = sensores.length;
            var sensor;
            var ul = document.getElementById("lista");
            var li = document.createElement("li");
            var divContenedor;
            var div1 = document.createElement("div");
            var div2 = document.createElement("div");
            var div4 = document.createElement("div");
            var div5 = document.createElement("div");
            imagen = document.createElement("img");

            sensor = sensores[i];
            console.log("Skeroo " + JSON.stringify(sensor.Usuario))
            // Creacion de los divs y texto de cada elemento -----------------------------------------

            li.className = "tarjetaLista shadow-sm mb-1 bg-white";

            divContenedor = document.createElement("div");
            divContenedor.className = "elementoLista row mr-0 ml-0";
            li.appendChild(divContenedor);

            div1.className = "columnasInfoSensor col-1";
            divContenedor.appendChild(div1);
            imagen.className = "iconoDeCadaElemento";

            div2.className = "columnasInfoSensor col-3 my-auto";
            divContenedor.appendChild(div2);

            div4.className = "columnasInfoSensor col-3 my-auto";
            divContenedor.appendChild(div4);

            div5.className = "columnasInfoSensor col-5 my-auto";
            divContenedor.appendChild(div5);

            var iconoEstado = "";
            var iconoAlt = ""

            //console.log("que " + sensor.Estado);

            if (sensor.Estado == "En Stock") {
                //console.log("nani " + sensor.Estado);
                iconoEstado = "box2";
                iconoAlt = "En Stock"
            }
            if (sensor.Estado == "Alquilado") {
                //console.log("nani " + sensor.Estado);
                iconoEstado = "tick2";
                iconoAlt = "Alquilado"
            }
            if (sensor.Estado == "Averiado") {
                //console.log("nani " + sensor.Estado);
                iconoEstado = "cross2";
                iconoAlt = "Averiado"
            }

            imagen.src = "../images/" + iconoEstado + ".png";
            imagen.alt = iconoAlt;
            div1.appendChild(imagen);
            div2.appendChild(document.createTextNode(sensor.TipoSensor));
            div4.appendChild(document.createTextNode(sensor.IdSensor));
            if (sensor.Usuario != null) { // Si esta en Stock no tendra ningun usuario asignado
                div5.appendChild(document.createTextNode(sensor.Usuario.Nombre));
            } else {
                div5.appendChild(document.createTextNode(""));
            }

            ul.appendChild(li);
            console.log(sensor);

            // Relleno de informacion en la tarjeta INFORMACION al clicar un sensor-----------------------------------------
            divContenedor.onclick = function() {

                iconoDesvincular.classList.add("invisible");

                unSensor = sensor;

                if (hayAlgunElementoSeleccionado == true) {
                    elementoSeleccionado.classList.remove("elementoNaranja");
                }

                divContenedor.classList.add("elementoNaranja");
                elementoSeleccionado = divContenedor;

                hayAlgunElementoSeleccionado = true;

                // Hacer invisible el boton desvincular si el sensor no esta en stock
                if (sensor.Estado != "En Stock") {
                    iconoDesvincular.classList.remove("invisible");
                }

                var divTextoSensor = document.getElementById("TextoSensor");
                divTextoSensor.innerHTML = "";
                divTextoSensor.appendChild(document.createTextNode("Sensor: "));

                var divIdSensor = document.getElementById("IdSensor");
                divIdSensor.innerHTML = "";
                divIdSensor.appendChild(document.createTextNode(parseInt(sensor.IdSensor)));

                var divTipoSensor = document.getElementById("TipoSensor");
                divTipoSensor.innerHTML = "";
                divTipoSensor.appendChild(document.createTextNode(sensor.TipoSensor));

                var divEstado = document.getElementById("Estado");
                divEstado.innerHTML = "";
                divEstado.appendChild(document.createTextNode(sensor.Estado));

                var divTextoUsuario = document.getElementById("TextoUsuario");
                var divTipoUsuario = document.getElementById("TipoUsuario");
                var divIdUsuario = document.getElementById("IdUsuario");
                var divNombre = document.getElementById("Nombre");
                var divCorreo = document.getElementById("Correo");
                var divTelefono = document.getElementById("Telefono");

                if (sensor.Usuario != null) {
                    divTextoUsuario.innerHTML = "";
                    divTextoUsuario.appendChild(document.createTextNode("Usuario: "));

                    divTipoUsuario.innerHTML = "";
                    divTipoUsuario.appendChild(document.createTextNode(sensor.Usuario.TipoUsuario));

                    divIdUsuario.innerHTML = "";
                    divIdUsuario.appendChild(document.createTextNode(sensor.Usuario.IdUsuario));

                    divNombre.innerHTML = "";
                    divNombre.appendChild(document.createTextNode(sensor.Usuario.Nombre));

                    divCorreo.innerHTML = "";
                    divCorreo.appendChild(document.createTextNode(sensor.Usuario.Email));

                    divTelefono.innerHTML = "";
                    divTelefono.appendChild(document.createTextNode(parseInt(sensor.Usuario.Telefono)));
                } else {
                    divTextoUsuario.innerHTML = "";
                    divTextoUsuario.appendChild(document.createTextNode("Usuario: "));

                    divTipoUsuario.innerHTML = "";
                    divTipoUsuario.appendChild(document.createTextNode(""));

                    divIdUsuario.innerHTML = "";
                    divIdUsuario.appendChild(document.createTextNode("El sensor está en el inventario"));

                    divNombre.innerHTML = "";
                    divNombre.appendChild(document.createTextNode(""));

                    divCorreo.innerHTML = "";
                    divCorreo.appendChild(document.createTextNode(""));

                    divTelefono.innerHTML = "";
                    divTelefono.appendChild(document.createTextNode(""));
                }

            };

        }

        // Funcion que crea un numero de elementos en la lista equivalente al numero total de sensores en la base de datos
        function crearUsuarioLista(i) {

            console.log("Llamada a crearUsuarioLista()");

            var maxListaUsuarios = numeroTotalDeUsuarios;
            var usuario;
            var li = document.createElement("li");
            var divContenedor;
            var div1 = document.createElement("div");
            var div2 = document.createElement("div");
            var div4 = document.createElement("div");
            var div5 = document.createElement("div");
            imagen = document.createElement("img");

            usuario = usuarios[i];

            // Creacion de los divs y texto de cada elemento -----------------------------------------

            li.className = "tarjetaLista shadow-sm mb-1 bg-white";

            divContenedor = document.createElement("div");
            divContenedor.className = "elementoLista row mr-0 ml-0";
            li.appendChild(divContenedor);

            div1.className = "columnasInfoSensor col-1";
            divContenedor.appendChild(div1);
            imagen.className = "iconoDeCadaElemento";

            div2.className = "columnasInfoSensor col-3 my-auto";
            divContenedor.appendChild(div2);

            div4.className = "columnasInfoSensor col-3 my-auto";
            divContenedor.appendChild(div4);

            div5.className = "columnasInfoSensor col-5 my-auto";
            divContenedor.appendChild(div5);

            var iconoTipo = "";
            var iconoAlt = "";

            //console.log("que " + sensor.Estado);

            if (usuario.TipoUsuario == "Normal") {
                //console.log("nani " + sensor.Estado);
                iconoTipo = "userNormal";
                iconoAlt = "Normal";
            }
            if (usuario.TipoUsuario == "Conductor") {
                //console.log("nani " + sensor.Estado);
                iconoTipo = "userConductor";
                iconoAlt = "Conductor";
            }
            if (usuario.TipoUsuario != "Normal" && usuario.TipoUsuario != "Conductor") { // Descarta los Admins ya que no los estamos teniendo en cuenta, Se puede pedir que se retoque el metodo de la logica
                return;
            }

            imagen.src = "../images/" + iconoTipo + ".png";
            imagen.alt = iconoAlt;
            div1.appendChild(imagen);
            if (usuario.IdUsuario == null) {
                div2.appendChild(document.createTextNode(""));
            } else {
                div2.appendChild(document.createTextNode(usuario.IdUsuario));
            }
            if (usuario.Nombre == null) {
                div4.appendChild(document.createTextNode(""));
            } else {
                div4.appendChild(document.createTextNode(usuario.Nombre));
            }
            if (usuario.IdSensor == null) {
                div5.appendChild(document.createTextNode(""));
            } else {
                div5.appendChild(document.createTextNode(usuario.IdSensor));
            }
            ul.appendChild(li);
            console.log(usuario);

            // Relleno de informacion en la tarjeta INFORMACION al clicar un usuario-----------------------------------------
            divContenedor.onclick = function() {

                unUsuario = usuario;

                if (hayAlgunElementoSeleccionado == true) {
                    elementoSeleccionado.classList.remove("elementoNaranja");
                }

                divContenedor.classList.add("elementoNaranja");
                elementoSeleccionado = divContenedor;

                hayAlgunElementoSeleccionado = true;

                var divTextoSensor = document.getElementById("TextoSensor");
                divTextoSensor.innerHTML = "";
                divTextoSensor.appendChild(document.createTextNode("Sensor: "));

                var divIdSensor = document.getElementById("IdSensor");
                divIdSensor.innerHTML = "";

                var divTipoSensor = document.getElementById("TipoSensor");
                divTipoSensor.innerHTML = "";

                var divEstado = document.getElementById("Estado");
                divEstado.innerHTML = "";

                if (usuario.Sensor != null) {
                    divTipoSensor.appendChild(document.createTextNode(usuario.Sensor.TipoSensor));
                    divEstado.appendChild(document.createTextNode(usuario.Sensor.Estado));
                    divIdSensor.appendChild(document.createTextNode(parseInt(usuario.IdSensor)));
                } else {
                    divTipoSensor.appendChild(document.createTextNode(""));
                    divEstado.appendChild(document.createTextNode(""));
                    divIdSensor.appendChild(document.createTextNode("No tiene sensor"));
                }

                var divTextoUsuario = document.getElementById("TextoUsuario");
                divTextoUsuario.innerHTML = "";
                divTextoUsuario.appendChild(document.createTextNode("Usuario: "));

                var divTipoUsuario = document.getElementById("TipoUsuario");
                divTipoUsuario.innerHTML = "";
                divTipoUsuario.appendChild(document.createTextNode(usuario.TipoUsuario));

                var divIdUsuario = document.getElementById("IdUsuario");
                divIdUsuario.innerHTML = "";
                divIdUsuario.appendChild(document.createTextNode(usuario.IdUsuario));

                var divNombre = document.getElementById("Nombre");
                divNombre.innerHTML = "";
                divNombre.appendChild(document.createTextNode(usuario.Nombre));

                var divCorreo = document.getElementById("Correo");
                divCorreo.innerHTML = "";
                divCorreo.appendChild(document.createTextNode(usuario.Email));

                var divTelefono = document.getElementById("Telefono");
                divTelefono.innerHTML = "";
                divTelefono.appendChild(document.createTextNode(parseInt(usuario.Telefono)));

            };

        }

        // Llamadas a rellenarTarjetasNumeroSensoresPorEstado para cada estado asi como escribir el Numero de Sensores
        async function rellenarTarjetasNumeroSensores() {

            rellenarTarjetasNumeroSensoresPorEstado(1, primeraLlamadaA_rellenarTarjetasNumeroSensores);
            rellenarTarjetasNumeroSensoresPorEstado(2, primeraLlamadaA_rellenarTarjetasNumeroSensores);
            rellenarTarjetasNumeroSensoresPorEstado(3, primeraLlamadaA_rellenarTarjetasNumeroSensores);

            // Si es la primera vez que se llama a esta funcion no se pueden borrar los numeros para volver a rellenarlos porque al cargarse la pagina estos numeros no estan todavia
            if (primeraLlamadaA_rellenarTarjetasNumeroSensores == false) {
                numeroSensores.innerHTML = "";
                numeroSensores.appendChild(document.createTextNode(parseInt(sensores.length)));
            } else {
                numeroSensores.appendChild(document.createTextNode(parseInt(sensores.length)));
                primeraLlamadaA_rellenarTarjetasNumeroSensores = false;
            }

        }

        // N: idEstado , bool: esLaPrimeraLlamada-->
        // rellenarTarjetasNumeroSensoresPorEstado
        // El booleano se utiliza para borrar el texto que hay previamente si no es la primera vez que se llama a rellenarTarjetasNumeroSensores
        function rellenarTarjetasNumeroSensoresPorEstado(idestado, esLaPrimeraLlamada) {

            var numeroSensoresSegunEstado = 0;
            var estadoJson = {
                "idestado": idestado
            };

            if (primeraLlamadaA_rellenarTarjetasNumeroSensores == false) {
                contenedorSensoresEnStock.innerHTML = innerHTMLDetarjetaExtra;
            }

            proxy.getNumSensoresSegunEstado(idestado, function(resp) {
                numeroSensoresSegunEstado = resp;

                if (idestado == 1) {
                    if (esLaPrimeraLlamada == false) {
                        sensoresEnStock.innerHTML = "";
                    }
                    sensoresEnStock.appendChild(document.createTextNode(parseInt(numeroSensoresSegunEstado))); // id 1 corresponde a sensores en stock
                }
                if (idestado == 2) {
                    if (esLaPrimeraLlamada == false) {
                        sensoresActivos.innerHTML = "";
                    }
                    sensoresActivos.appendChild(document.createTextNode(parseInt(numeroSensoresSegunEstado))); // id 2 corresponde a sensores activos
                }
                if (idestado == 3) {
                    if (esLaPrimeraLlamada == false) {
                        sensoresInactivos.innerHTML = "";
                    }
                    sensoresInactivos.appendChild(document.createTextNode(parseInt(numeroSensoresSegunEstado))); // id 3 corresponde a sensores inactivos
                }

            });

        }

        function llamadaAgetUsuariosYSusSensoresYARellenarTarjetasNumeroUsuarios() {
            console.log("llamadaAgetUsuariosYSusSensoresYARellenarTarjetasNumeroUsuarios");

            innerHTMLDetarjetaExtra = tarjeta4.innerHTML;
            tarjeta4.innerHTML = "";

            usuarios = 0;

            proxy.getTodosLosUsuariosYSusSensores(function(resp) {

                usuarios = resp;

                console.log("Numero de usuarios: " + resp.length);
                console.log("Primer usuario " + sensores[0]);
                console.log("Adios :) " + 1);

                for (var i = 0; i < usuarios.length; i++) {
                    crearUsuarioLista(i);
                }

                // Mostrar numero de usuarios
                rellenarTarjetasNumeroUsuarios();

            });

        }

        // Llamadas a rellenarTarjetasNumeroSensoresPorEstado para cada estado asi como escribir el Numero de Usuarios
        async function rellenarTarjetasNumeroUsuarios() {
            console.log("rellenarTarjetasNumeroUsuarios");

            rellenarTarjetasNumeroUsuariosPorTipo("Normal");
            rellenarTarjetasNumeroUsuariosPorTipo("Conductor");
            // Esta tarjeta la borramos porque solo necesitamos 3 para mostrar los numeros de usuarios
            //tarjetaEliminada.innerHTML = "";

        }

        // String: tipo -->
        // rellenarTarjetasNumeroUsuariosPorTipo
        async function rellenarTarjetasNumeroUsuariosPorTipo(tipo) {

            var numeroUsuariosSegunTipo = 0;
            var estadoJson = {
                "tipo": tipo
            };
            proxy.getNumeroUsuariosTotalesPorTipo(tipo, function(resp) {
                numeroUsuariosSegunTipo = resp;

                if (tipo == "Normal") {
                    usuariosNormales.innerHTML = "";
                    usuariosNormales.appendChild(document.createTextNode(parseInt(numeroUsuariosSegunTipo)));
                    numeroTotalDeUsuarios = numeroTotalDeUsuarios + numeroUsuariosSegunTipo;
                    console.log(tipo + " " + numeroUsuariosSegunTipo);
                }
                if (tipo == "Conductor") {
                    usuariosConductores.innerHTML = "";
                    usuariosConductores.appendChild(document.createTextNode(parseInt(numeroUsuariosSegunTipo)));
                    numeroTotalDeUsuarios = numeroTotalDeUsuarios + numeroUsuariosSegunTipo;
                    console.log(tipo + " " + numeroUsuariosSegunTipo);

                    console.log("Numero total de usuarios " + numeroTotalDeUsuarios);
                }

                // Se rellena la tarjeta con el numero de usuarios totales despues de haber sumado los normales y los conductores
                numeroUsuarios.innerHTML = "";
                numeroUsuarios.appendChild(document.createTextNode(parseInt(numeroTotalDeUsuarios)));

            });

        }


        function setCookie(cname, cvalue) {
            //var d = new Date();
            // d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
            //var expires = "expires=" + d.toUTCString();
            document.cookie = cname + "=" + cvalue + ";" + ";path=/";
        }

        function getCookie(cname) {
            var name = cname + "=";
            var ca = document.cookie.split(';');
            for (var i = 0; i < ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                }
            }
            return "";
        }

        function checkCookie() {
            var user = getCookie("username");
            var url = direccion + "/ux/html/LoginAdmin.html";
            if (user == "") {
                //alert("No intentes entrar desde la url pillín");
                var a = document.createElement("a");
                a.href = url;
                a.click();
            }
        }

        // Elimina las cookies de la pagina. Se le llama al clicar a Cerrar Sesion
        function eliminarCookies() {
            console.log("Leyenda");
            document.cookie.split(";").forEach(function(c) {
                document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/");
            });

            var url = direccion + "/ux/html/LoginAdmin.html";
            var a = document.createElement("a");
            a.href = url;
            a.click();

        }


        function insertarUsuario() {

            var email = document.getElementById('emailR').value;
            var pass = document.getElementById('passR').value;
            var pass2 = document.getElementById('RpassR').value;
            var tel = document.getElementById('telR').value;

            if (pass == pass2) {
                proxy.insertarUsuario(email, pass, tel);
            } else {
                console.log("error");
            }

        }

        function ComprobarUsuario() {

            var email = document.getElementById('email').value;
            var pass = document.getElementById('pass').value;

            var data = {
                Email: email,
                Password: pass
            };

            proxy.ComprobacionLogin(data);

        }

        /****************************************************************************************
        clicBotonError()

        Limpiara la lista de sensores y la llenara con los que hayan dado lecturas erroneas tras
        comprobar cuales son dichos nodos

        Iván
        ****************************************************************************************/
        function clicBotonError() {
            if (mostrandoErrores == false) {
                mostrandoErrores = true;

                iconoError.classList.add("iconoErrorSeleccionado");
                // Eliminado boton Add y Can
                iconoAddInnerHTML = iconoAdd.innerHTML;
                iconoAdd.innerHTML = "";
                iconoCanInnerHTML = iconoCan.innerHTML;
                iconoCan.innerHTML = "";

                // Borrado de elementos de la lista
                var ul = document.getElementById("lista");
                var li = document.getElementsByClassName("tarjetaLista");
                var tamañoLista = ul.getElementsByClassName("tarjetaLista").length;
                var i = 0;
                while (i <= tamañoLista - 1) {
                    console.log(i);
                    ul.removeChild(li[0]);
                    i++;
                }

                // Vaciado de la tarjeta INFORMACION
                tarjetaINFORMACION.innerHTML = innerHTMLTarjetaINFORMACION;
                
                // Funciones del PROXY que listan los sensores que han emitido varias lecturas erronas
                proxy.getTodosErroresDeSensoresSinRevision(function(resp){
                    sensores = resp;
                    console.log("adios "+resp.length);
                    for (var i = 0; i < resp.length; i++) {
                        crearSensorLista(i);
                    }
                });
                
                
            } else {
                mostrandoErrores = false;

                iconoError.classList.remove("iconoErrorSeleccionado");
                // Aparece boton Add
                iconoAdd.innerHTML = iconoAddInnerHTML;
                iconoCan.innerHTML = iconoCanInnerHTML;

                //Rellenado de tarjeta con todos los sensores
                proxy.getSensoresYSusUsuarios(function(resp) {
                    sensores = resp;

                    console.log("Numero de sensores: " + resp.length);
                    console.log("Primer sensor " + sensores[0]);
                    console.log("Adios " + 1);

                    for (var i = 0; i < sensores.length; i++) {
                        crearSensorLista(i);
                    }
                });
            }

        }

        // Funcion que se llamara al clicar el boton del mas que añadira una relacion Usuario-Sensor cambiando una por otra
        function clicBotonAdd() {
            console.log("Esto añadirá un sensor enlazado a un usuario");

            // botonModal.classList.remove("invisible");
            if (modoActual == 0) {
                crearEscanerQR();
            }
            // Para apartado Usuarios 
            else {
                $("#modal").modal();
                botonModal.classList.remove("invisible");
                textoModal.innerHTML = "";
                textoModal.appendChild(document.createTextNode("Estás a punto de AÑADIR un USUARIO a la BASE DE DATOS."));
                botonModal.innerHTML = "";
                botonModal.appendChild(document.createTextNode("AÑADIR"));
            }

        }

        // Funcion que se llamara al clicar a la basura que elminiara un sensor
        function clicBotonBorrar() {
            console.log("Esto eliminará un sensor");

            if (hayAlgunElementoSeleccionado) {
                botonModal.classList.remove("invisible");
                if (modoActual == 0) {
                    $("#modal").modal();
                    textoModal.innerHTML = "";
                    textoModal.appendChild(document.createTextNode("Vas a BORRAR un SENSOR de la BASE DE DATOS."));
                    botonModal.innerHTML = "";
                    botonModal.appendChild(document.createTextNode("BORRAR"));
                    botonModal.onclick = eliminarSensorOUsuario();
                } else {
                    $("#modal").modal();
                    textoModal.innerHTML = "";
                    textoModal.appendChild(document.createTextNode("Vas a BORRAR un USUARIO de la BASE DE DATOS."));
                    botonModal.innerHTML = "";
                    botonModal.appendChild(document.createTextNode("BORRAR"));
                }
            } else {
                textoModal.innerHTML = "";
                textoModal.appendChild(document.createTextNode("Tienes que seleccionar un elemento para borrarlo"));
                botonModal.innerHTML = "";
                botonModal.classList.add("invisible");
                botonModal.onclick = eliminarSensorOUsuario();
            }

        }

        function clicBotonModal() {

            if (modoActual == 0) { // Borrar sensor o desvincular
                if (botonModal.textContent == "DESVINCULAR") {
                    console.log("Desvinculado sensor: " + unSensor.Usuario.IdUsuario);

                    proxy.desvincularUsuarioDeSensorPorIdUsuario(unSensor.Usuario.IdUsuario);

                    location.reload();

                } else {
                    console.log("Borrado sensor: " + unSensor.IdSensor);

                    elementoSeleccionado.innerHTML = "";
                    proxy.borrarSensorPorID(unSensor.IdSensor);

                    tarjetaINFORMACION.innerHTML = innerHTMLTarjetaINFORMACION;

                    // Hacer boton desvincular invisible
                    iconoDesvincular.classList.add("invisible");
                }

            }

            if (modoActual == 1) {
                console.log("Borrado usuario: " + unUsuario.IdUsuario);

                elementoSeleccionado.innerHTML = "";
                proxy.borrarUsuarioPorID(unUsuario.IdUsuario);

                numeroTotalDeUsuarios = 0;

                ul.innerHTML = "";

                llamadaAgetUsuariosYSusSensoresYARellenarTarjetasNumeroUsuarios();

                numeroSensores.innerHTML = "";
                numeroSensores.appendChild(document.createTextNode(parseInt(numeroSensores)));

                tarjetaINFORMACION.innerHTML = innerHTMLTarjetaINFORMACION;

            }
        }

        //Esto es para poder asignarle un nombre al gas dependiendo de su ID
        function queGasSoy(dato) {
            var gas;
            if (dato == 2) {
                gas = "CO";
            } else {
                if (dato == 3) {
                    gas = "NOX";
                } else {
                    if (dato == 4) {
                        gas = "SO2";
                    } else {
                        gas = "Gas Irritante";
                    }
                }
            }
            return gas;
        }

        //Recibe las medidas y dibuja los marcadores
        function recibirMedidasFecha(intervalo) {
            //Recojo los datos de la base de datos
            proxy.getTodasLasMedidasPorFecha(intervalo, function(datos) {
                // console.log(datos);
                console.log("DATOS DE MEDIDAS POR FECHA" + datos["medidas"].length);
                var poluzone = [];

                var infowindow = new google.maps.InfoWindow()

                for (let i = 0; i < datos["medidas"].length; i++) {

                    var iconBase = 'http://maps.google.com/mapfiles/ms/icons/';
                    var icon;
                    /*if(datos[i].IdTipoMedida == 2){
                        icon = iconBase + 'purple-dot.png'
                    }*/
                    if (datos["medidas"][i].IdTipoMedida == 1) {
                        icon = iconBase + 'green.png'
                    } else {
                        if (datos["medidas"][i].IdTipoMedida == 2) {
                            icon = iconBase + 'yellow.png'
                        } else {
                            if (datos["medidas"][i].IdTipoMedida == 3) {
                                icon = iconBase + 'red.png'
                            } else {
                                if (datos["medidas"][i].IdTipoMedida == 4) {
                                    icon = iconBase + 'purple.png'
                                } else {
                                    icon = iconBase + 'lightblue.png'
                                }
                            }
                        }
                    }
                    var medida = new google.maps.Marker({
                        position: {
                            lat: datos["medidas"][i].Latitud,
                            lng: datos["medidas"][i].Longitud
                        },
                        map: getMap(),
                        title: 'Medidas',
                        icon: {
                            url: icon
                        },
                    });

                    arrayMarcadores.push(medida);

                    var puntoCalor = {
                        location: new google.maps.LatLng(datos["medidas"][i].Latitud, datos["medidas"][i].Longitud),
                        weight: datos["medidas"][i].Valor
                    };

                    poluzone.push(puntoCalor);

                    var contentString = '<div id="content">' +
                        '<div id="siteNotice">' +
                        '</div>' +
                        '<h1 id="firstHeading" class="firstHeading">' + datos["medidas"][i].Valor.toString() + ' ppb</h1>' +
                        '<div id="bodyContent">' +
                        '<p><b>' + queGasSoy(datos["medidas"][i].IdTipoMedida) + '</b></p>' +
                        '<p></p>' +
                        '</div>' +
                        '</div>';


                    google.maps.event.addListener(medida, 'click', (function(marker, content, infowindow) {
                        return function() {
                            infowindow.setContent(content);
                            infowindow.open(getMap(), marker);
                        };
                    })(medida, contentString, infowindow));



                } //for
                heatmap = new google.maps.visualization.HeatmapLayer({
                    data: poluzone,
                    maxIntensity: 163,
                    radius: 60
                });
                heatmap.setMap(getMap());
            });
        }

        // Cambia la información de la página de sensores a usuarios
        function cambioAUsuarios() {
            console.log("Llamada a cambiarAUsuarios()");

            if (modoActual == 0) { // Solo funciona cuando el modo previo al clic es el contrario

                reiniciarMarcadores();

                hayAlgunElementoSeleccionado = false; // Para indicar que no hay ningun elemento seleccionado

                // Hacer invisible el boton errores y el de desvincular
                iconoError.classList.remove("iconoErrorSeleccionado");
                botonError.classList.add("invisible");
                mostrandoErrores = false;
                iconoDesvincular.classList.add("invisible");

                numeroTotalDeUsuarios = 0;

                // Pulso
                pulse1.className = "pulse1";
                pulse2.classList.remove("pulse2");

                modoActual = 1;

                var ul = document.getElementById("lista");
                var li = document.getElementsByClassName("tarjetaLista");
                var tamañoLista = ul.getElementsByClassName("tarjetaLista").length;

                var br1 = document.createElement("br");
                var br2 = document.createElement("br");
                var br3 = document.createElement("br");

                // Cambio en los botones            
                botonUsuarios.style.color = '#F88E52';
                botonSensores.style.color = 'white';

                var i = 0;
                while (i <= tamañoLista - 1) {
                    console.log(i);
                    ul.removeChild(li[0]);
                    i++;
                }

                // Rellenado de la lista y de las tarjetas
                llamadaAgetUsuariosYSusSensoresYARellenarTarjetasNumeroUsuarios();

                // Cambio del texto de las tarjetas
                textoTarjeta1.innerHTML = "";
                textoTarjeta2.innerHTML = "";
                textoTarjeta3.innerHTML = "";

                textoTarjeta1.appendChild(document.createTextNode("Número de"));
                textoTarjeta1.appendChild(br1);
                textoTarjeta1.appendChild(document.createTextNode("usuarios"));
                textoTarjeta2.appendChild(document.createTextNode("Usuarios"));
                textoTarjeta2.appendChild(br2);
                textoTarjeta2.appendChild(document.createTextNode("normales"));
                textoTarjeta3.appendChild(document.createTextNode("Usuarios"));
                textoTarjeta3.appendChild(br3);
                textoTarjeta3.appendChild(document.createTextNode("conductores"));

                // Cambio texto SENSORES a USUARIOS
                textoSENSORESyUSUARIOS.innerHTML = "";
                textoSENSORESyUSUARIOS.appendChild(document.createTextNode("USUARIOS"));

                // Eliminado boton Add
                iconoAddInnerHTML = iconoAdd.innerHTML;
                iconoAdd.innerHTML = "";

                // Cambio nombre columnas de la de la lista
                textoColumna1.innerHTML = "";
                textoColumna2.innerHTML = "";
                textoColumna3.innerHTML = "";
                textoColumna4.innerHTML = "";

                textoColumna1.appendChild(document.createTextNode("Tipo"));
                textoColumna2.appendChild(document.createTextNode("Id usuario"));
                textoColumna3.appendChild(document.createTextNode("Nombre"));
                textoColumna4.appendChild(document.createTextNode("Id sensor"));

                // Cambiar iconos de las tarjetas
                icono1.src = "../images/todosLosUsers.png";
                icono2.src = "../images/userNormal.png";
                icono3.src = "../images/userConductor.png";

                // Vaciado de la tarjeta INFORMACION
                tarjetaINFORMACION.innerHTML = innerHTMLTarjetaINFORMACION;

                // Limpiar calendario
                var date = new Date();
                var fecha = document.getElementById("datepicker").value = (date.getMonth() + 1) + "/" + date.getDate() + "/" + date.getFullYear();
            }

        }

        function cambioASensores() {
            console.log("Llamada a cambiarAUsuarios()");

            if (modoActual == 1) { // Solo funciona cuando el modo previo al clic es el contrario

                borrarMarcadores();

                hayAlgunElementoSeleccionado = false; // Para indicar que no hay ningun elemento seleccionado

                // Hacer visible boton error
                botonError.classList.remove("invisible");

                // Pulso
                pulse2.className = "pulse2";
                pulse1.classList.remove("pulse1");

                modoActual = 0;

                var ul = document.getElementById("lista");
                var li = document.getElementsByClassName("tarjetaLista");
                var tamañoLista = ul.getElementsByClassName("tarjetaLista").length;

                var br1 = document.createElement("br");
                var br2 = document.createElement("br");
                var br3 = document.createElement("br");

                // Cambio en los botones
                botonUsuarios.style.color = 'white';
                botonSensores.style.color = '#F88E52';

                var i = 0;
                while (i <= tamañoLista - 1) {
                    ul.removeChild(li[0]);
                    i++;
                }

                // Rellenado de la lista y de las tarjetas
                llamadaAgetSensoresYSusUsuariosYARellenarTarjetasNumeroSensores();

                // Cambio del texto de las tarjetas
                textoTarjeta1.innerHTML = "";
                textoTarjeta2.innerHTML = "";
                textoTarjeta3.innerHTML = "";

                textoTarjeta1.appendChild(document.createTextNode("Número de"));
                textoTarjeta1.appendChild(br1);
                textoTarjeta1.appendChild(document.createTextNode("sensores"));
                textoTarjeta2.appendChild(document.createTextNode("Sensores"));
                textoTarjeta2.appendChild(br2);
                textoTarjeta2.appendChild(document.createTextNode("alquilados"));
                textoTarjeta3.appendChild(document.createTextNode("Sensores"));
                textoTarjeta3.appendChild(br3);
                textoTarjeta3.appendChild(document.createTextNode("Averiados"));

                //Cambio texto USUARIOS a SENSORES
                textoSENSORESyUSUARIOS.innerHTML = "";
                textoSENSORESyUSUARIOS.appendChild(document.createTextNode("SENSORES"));

                // Añadir boton Add
                iconoAdd.innerHTML = iconoAddInnerHTML;

                // Cambio nombre columnas de la de la lista

                textoColumna1.innerHTML = "";
                textoColumna2.innerHTML = "";
                textoColumna3.innerHTML = "";
                textoColumna4.innerHTML = "";

                textoColumna1.appendChild(document.createTextNode("Estado"));
                textoColumna2.appendChild(document.createTextNode("Tipo"));
                textoColumna3.appendChild(document.createTextNode("Id sensor"));
                textoColumna4.appendChild(document.createTextNode("Usuario"));

                // Cambiar iconos de las tarjetas
                icono1.src = "../images/sensor1.png";
                icono2.src = "../images/tick2.png";
                icono3.src = "../images/cross2.png";

                // Vaciado de la tarjeta INFORMACION
                tarjetaINFORMACION.innerHTML = innerHTMLTarjetaINFORMACION;

                // Limpiar calendario
                var date = new Date();
                var fecha = document.getElementById("datepicker").value = (date.getMonth() + 1) + "/" + date.getDate() + "/" + date.getFullYear();

            }

        }

        function clicBotonDesvincular() {

            botonModal.classList.remove("invisible");
            if (modoActual == 0) {
                textoModal.innerHTML = "";
                textoModal.appendChild(document.createTextNode("¿DESVINCULAR sensor de su usuario?"));
                botonModal.innerHTML = "";
                botonModal.appendChild(document.createTextNode("DESVINCULAR"));
            } else {
                textoModal.innerHTML = "";
                textoModal.appendChild(document.createTextNode("Selecciona un sensor para DESVINCULARLO del usuario"));
                botonModal.innerHTML = "";
                botonModal.classList.add("invisible");
            }

        }

        /****************************************************************************************
        convertirFechaAJson()
        --> {int,int}

        Es llamada cuando se elige un dia en el calendario y convierte el texto en un json con 
        desde y hasta, el cual manda a recibirMedidasFecha() para cambiar los puntos del mapa

        Iván
        ****************************************************************************************/
        function convertirFechaAJson() {
            var fecha = document.getElementById("datepicker").value;

            var fechaDesde = new Date(fecha + " 00:00:00");
            var fechaHasta = new Date(fecha + " 23:59:59");
            var millisegundosDesde = fechaDesde.getTime();
            //console.log("osea que"+millisegundosDesde);
            var millisegundosHasta = fechaHasta.getTime();

            borrarMarcadores();

            recibirMedidasFecha({
                "desde": millisegundosDesde,
                "hasta": millisegundosHasta
            });
        }

        /****************************************************************************************
        borrarMarcadores()

        Elimina los marcadores y los puntos de calor cuando se va a modificar el mapa para que
        muestre las medidas de una fecha concreta

        Iván
        ****************************************************************************************/
        function borrarMarcadores() {
            for (var i = 0; i < arrayMarcadores.length; i++) {
                arrayMarcadores[i].setMap(null);
            };

            arrayMarcadores = [];
            heatmap.setMap(null);
            heatmap = [];
        }

        /****************************************************************************************
        reiniciarMarcadores()

        Elimina los marcadores y los puntos de calor cuando se va a modificar el mapa para que
        muestre las medidas de una fecha concreta

        Iván
        ****************************************************************************************/
        function reiniciarMarcadores() {
            for (var i = 0; i < arrayMarcadores.length; i++) {
                arrayMarcadores[i].setMap(null);
            };

            arrayMarcadores = [];
            heatmap.setMap(null);
            heatmap = [];

            recibirMedidasFecha({
                "desde": hoy00,
                "hasta": hoy24
            });
        }

    </script>

    <!-- Barra de busqueda (barra-busqueda.js)-->
    <script>
        function buscador() {
            // Declare variables
            var input, filter, ul, li, a, i, txtValue, imgalt, filtro;
            input = document.getElementById('barraSensores');
            filter = input.value.toUpperCase();
            ul = document.getElementById("lista");

            li = ul.getElementsByTagName('li');

            // Loop through all list items, and hide those who don't match the search query
            for (i = 0; i < li.length; i++) {
                divContenedor = li[i].getElementsByTagName("div")[0];
                imgalt = divContenedor.getElementsByTagName("div")[0].getElementsByTagName("img")[0].alt;
                filtro = divContenedor.textContent + imgalt
                txtValue = filtro;
                console.log(txtValue)
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    li[i].style.display = "";
                } else {
                    li[i].style.display = "none";
                }
            }
        }

    </script>

    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Nunito" />

    <!--  css de bootsrap  -->
    <link rel="stylesheet" href="../css/estilos.css">
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link href="../css/bootstrap.min.css" rel="stylesheet">


    <!-- iconos Material Design -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">


    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Poluzone | Admin</title>

    <!-- CSS de Bootstrap -->
    <link href="../css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!-- librerías opcionales que activan el soporte de HTML5 para IE8 -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<!----------------------------------------------------- BODY --------------------------------------------------------->

<body id="page-top" onload="">
    <!-------------------------------------------------- CONTENEDOR ----------------------------------------------------------->

    <!-- Modal -->
    <div class="modal fade" id="modal" tabindex="4" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title naranja" id="modalLabel">ATENCIÓN</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="textoModal">
                    Texto del modal
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-primary btn-lg" id="botonModal" onclick="clicBotonModal()" data-dismiss="modal">Save changes</button>
                </div>
            </div>
        </div>
    </div>

    <div class="contenedor">

        <!---- PULSOS ---->
        <div class="contenedorPulsos">
            <span class="" id="pulse1"></span>
            <span class="" id="pulse2"></span>
        </div>

        <!------------------------------------------------ NAVBAR -------------------------------------------------------->

        <div class="navbar navbarAdmin">

            <!-- Navigation -->
            <nav class="navbar navbar-expand-lg navbar-dark fixed-top fondoOscuro navbar-shrink8" id="darkNav">
                <div class="container">
                    <a class="navbar-brand js-scroll-trigger nunito" href="index.html"><img src="../images/earth.png" width="30" alt=""> Poluzone</a>
                    <a class="navbar-toggler navbar-toggler-right nunito" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                        <i class="material-icons">
                            menu
                        </i>
                    </a>
                    <div class="collapse navbar-collapse" id="navbarResponsive">

                        <ul class="navbar-nav text-uppercase w-100">

                            <li class="align-self-center ml-5">
                                <a class="modoSensores" id="modoSensores" onclick="cambioASensores()" href="#contact">SENSORES</a>
                            </li>

                            <li class="align-self-center ml-2">
                                <a class="modoUsuarios" id="modoUsuarios" onclick="cambioAUsuarios()" href="#contact">USUARIOS</a>
                            </li>

                            <ul class="ml-auto w-100">

                                <li class="cerrarSesion nav-item ml-auto">
                                    <a class="nav-link js-scroll-trigger" onclick="eliminarCookies()" href="#contact">CERRAR SESIÓN</a>
                                </li>

                            </ul>

                        </ul>

                    </div>

                </div>

            </nav>


        </div>

        <!------------------------------------------------ CUERPO -------------------------------------------------------->

        <div class="cuerpo container">

            <!----------------------------------- CONTENEDOR DE TARJETAS ----------------------------------------->

            <div class="tarjetasInfoGeneral row">

                <!----------------------------------- TARJETA 1 ----------------------------------------->

                <div class="col-lg-3">

                    <div class="tarjeta shadow bg-white rounded my-auto">

                        <div class="iconoTarjeta my-auto">

                            <img src="../images/sensor1.png" class="icono" id="icono1">

                        </div>

                        <div class="textoTarjeta my-auto font-weight-bold textoTarjeta1" id="textoTarjeta1">

                            Número de<br>sensores

                        </div>

                        <div class="valorTarjeta my-auto font-weight-bold" id="valorTarjeta1">



                        </div>

                    </div>

                </div>


                <!----------------------------------- TARJETA 2 ----------------------------------------->

                <div class="col-lg-3">

                    <div class="tarjeta shadow bg-white rounded my-auto">

                        <div class="iconoTarjeta my-auto">

                            <img src="../images/tick2.png" class="icono" id="icono2">

                        </div>

                        <div class="textoTarjeta my-auto font-weight-bold textoTarjeta2" id="textoTarjeta2">

                            Sensores<br>alquilados

                        </div>

                        <div class="valorTarjeta my-auto font-weight-bold" id="valorTarjeta2">



                        </div>

                    </div>

                </div>

                <!----------------------------------- TARJETA 3 ----------------------------------------->

                <div class="col-lg-3">

                    <div class="tarjeta shadow bg-white rounded my-auto">

                        <div class="iconoTarjeta my-auto ">

                            <img src="../images/cross2.png" class="icono" id="icono3">

                        </div>

                        <div class="textoTarjeta my-auto font-weight-bold textoTarjeta3" id="textoTarjeta3">

                            Sensores<br>averiados

                        </div>

                        <div class="valorTarjeta my-auto font-weight-bold" id="valorTarjeta3">



                        </div>

                    </div>

                </div>

                <!----------------------------------- TARJETA 4 ----------------------------------------->

                <div class="col-lg-3" id="tarjeta4">

                    <div class="tarjeta shadow bg-white rounded my-auto">

                        <div class="iconoTarjeta my-auto">

                            <img src="../images/box2.png" class="icono">

                        </div>

                        <div class="textoTarjeta my-auto font-weight-bold textoTarjeta4" id="textoTarjeta4">

                            Sensores<br>en stock

                        </div>

                        <div class="valorTarjeta my-auto font-weight-bold" id="valorTarjeta4">



                        </div>

                    </div>

                </div>

            </div>

            <!----------------------------------- /CONTENEDOR DE TARJETAS ----------------------------------------->

            <!----------------------------------- SUBCUERPO ----------------------------------------->


            <div class="subcuerpo row">

                <!----------------------------------- TARJETAS CON INFORMACION DE SENSORES ----------------------------------------->

                <div class="tarjetasInfoSensores col">

                    <!----------------------------------- TARJETA CON TODOS LOS SENSORES ----------------------------------------->


                    <div class="fila row-lg-6 my-auto pb-3">
                        <!--contenedorDeTarjeta-->

                        <div class="tarjetaInfo shadow bg-white rounded my-auto">
                            <!--tarjeta-->

                            <div class="contenedorSensores col">
                                <!--contenido de la tarjeta-->

                                <!----------------------------------- CABECERA SENSORES ----------------------------------------->


                                <div class="headerLista row">

                                    <div class="textoSensores my-auto col-3" id="textoSensores">

                                        SENSORES

                                    </div>

                                    <div class="contenedorSearch col-6 my-auto">

                                        <input class="cajaDeTexto form-control form-control-sm ml-3 w-75 text-light" id="barraSensores" type="text" placeholder="Buscar palabras clave..." aria-label="Search" onkeyup="buscador()">

                                    </div>

                                    <div class="contenedorIconosEditar col-1 my-auto" onclick="clicBotonError()" id="botonError">

                                        <img src="../images/warning.png" class="iconoError" id="iconoError" alt="Lecturas Erróneas">

                                    </div>

                                    <div class="contenedorIconosEditar col-1 my-auto" onclick="clicBotonAdd()" id="botonAdd">

                                        <img src="../images/add.png" class="iconoAdd" alt="Añadir">

                                    </div>

                                    <div class="contenedorIconosEditar col-1 my-auto" onclick="clicBotonBorrar()" id="botonCan">

                                        <img src="../images/can.png" class="iconoCan" alt="Borrar" data-toggle="modal" data-target="#modal">

                                    </div>

                                </div>

                                <!----------------------------------- /CABECERA SENSORES ----------------------------------------->

                                <!----------------------------------- LISTA SENSORES ----------------------------------------->


                                <div class="contenedorLista">

                                    <!----------------------- CABECERA NOMBRES CADA COLUMNA DE LA LISTA ------------------------->


                                    <div class="nombresLista row mr-0 ml-0 border-bottom">

                                        <div class="columnasInfoSensor col-1 font-weight-bold" id="textoColumna1">

                                            Estado

                                        </div>

                                        <div class="columnasInfoSensor col-3 font-weight-bold" id="textoColumna2">

                                            Tipo

                                        </div>

                                        <div class="columnasInfoSensor col-3 font-weight-bold" id="textoColumna3">

                                            Id sensor

                                        </div>

                                        <div class="columnasInfoSensor col-5 font-weight-bold" id="textoColumna4">

                                            Usuario

                                        </div>

                                    </div>

                                    <!------------------------------------- LISTA --------------------------------------->

                                    <ul class="lista rounded-bottom" id="lista">

                                        <!----------------------- ELEMENTO DE LA LISTA ------------------------->


                                        <!--<li class="tarjetaLista shadow mb-1 bg-white" id="tarjetaLista">

                                            <div class="elementoLista row mr-0 ml-0">

                                                <div class="columnasInfoSensor col-1">

                                                    Estado

                                                </div>

                                                <div class="columnasInfoSensor col-2">

                                                    Tipo

                                                </div>

                                                <div class="columnasInfoSensor col-4">

                                                    Id sensor

                                                </div>

                                                <div class="columnasInfoSensor col-5">

                                                    Usuario

                                                </div>

                                            </div>

                                        </li>-->

                                        <!----------------------- /ELEMENTO DE LA LISTA ------------------------->


                                    </ul>

                                </div>

                                <!----------------------------------- /LISTA SENSORES ----------------------------------------->


                            </div>

                        </div>

                    </div>

                    <!----------------------------------- TARJETA CON INFORMACION DE UN SENSOR ----------------------------------------->

                    <div class="fila row-lg-6 my-auto">

                        <div class="tarjetaInfo shadow bg-white rounded my-auto">

                            <div class="headerLista row">

                                <div class="textoSensores my-auto col-3">

                                    INFORMACIÓN

                                </div>
                                <div class="col-8"></div>

                                <div class="contenedorIconoDesvincular col-1 my-auto" id="contenedorIconoDesvincular" onclick="clicBotonDesvincular()">

                                    <img src="../images/desvincular.png" class="iconoDesvincular invisible" alt="Desvincular" id="iconoDesvincular" data-toggle="modal" data-target="#modal">

                                </div>

                            </div>

                            <div class="informacionUsuario col" id="informacionUsuario">

                                <div class="datosSensor row border-bottom" id="datosSensor">

                                    <div class="datoSensor font-weight-bold" id="TextoSensor">



                                    </div>

                                    <div class="contenedor1">

                                        <div class="datoSensor" id="IdSensor">



                                        </div>

                                        <div class="datoSensor" id="TipoSensor">



                                        </div>

                                        <div class="datoSensor" id="Estado">



                                        </div>

                                    </div>

                                </div>

                                <div class="datosUsuario row" id="datosUsuario">

                                    <div id="TextoUsuario" class="nombreTipoId font-weight-bold">



                                    </div>

                                    <div class="contenedor1">


                                        <div id="IdUsuario" class="nombreTipoId">



                                        </div>

                                        <div class="nombreTipoId" id="Nombre">



                                        </div>

                                        <div id="TipoUsuario" class="nombreTipoId">



                                        </div>

                                    </div>

                                </div>


                                <div class="correo row" id="Correo">



                                </div>

                                <div class="telefono row" id="Telefono">



                                </div>

                            </div>

                        </div>

                    </div>

                </div>

                <!----------------------------------- /TARJETAS CON INFORMACION DE SENSORES ----------------------------------------->

                <!----------------------------------- MAPA ----------------------------------------->

                <div class="columnaMapa col">
                    <div class="tarjetaCalendario shadow bg-white rounded mb-1 p-1 mx-auto">
                        <div class="contenedorCalendario row mx-auto">
                            <p class="my-auto mr-2">Fecha:</p>
                            <input id="datepicker" width="200" onchange="convertirFechaAJson()" />
                            <script>
                                $('#datepicker').datepicker();

                            </script>
                        </div>
                    </div>
                    <div class="contenedorMapa shadow bg-white rounded">
                        <div class="mapAdmin" id="mapAdmin">
                        </div>
                    </div>
                </div>

                <!----------------------------------- /MAPA ----------------------------------------->

            </div>

            <!----------------------------------- /SUBCUERPO ----------------------------------------->

        </div>

        <!------------------------------------------------ /CUERPO -------------------------------------------------------->


        <!------------------------------------------------ FOOTER -------------------------------------------------------->
        <footer class="footer fixed-bottom footerAdmin">

            <section class="section_4 text-center fondoOscuro p-1">
                <p class="mt-2 nunito blanco nunito">&copy; Copyright 2019 GTI UPV. Todos los Derechos
                    Reservados
                </p>
            </section>
        </footer>

        <!------------------------------------------------ /FOOTER -------------------------------------------------------->

    </div>
    <!--/contenedor-->

    <!-------------------------------------------------- /CONTENEDOR ----------------------------------------------------------->


    <!-- Modal añadir sensor-->
    <div class="modal fade" id="modal-anyadir-sensor" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Añadir sensor</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Escanea el QR del sensor para añadirlo a la base de datos.</p>
                    <video id="preview" class="w-100"></video>
                    <p id="qr-escaneado-p">QR escaneado: </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="anyadirSensor()">Añadir sensor</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Librería jQuery requerida por los plugins de JavaScript -->
    <script src="https://code.jquery.com/jquery.js"></script>

    <!-- Todos los plugins JavaScript de Bootstrap (también puedes
                incluir archivos JavaScript individuales de los únicos
                plugins que utilices) -->
    <script src="../js/bootstrap.min.js"></script>
    <!-- Custom scripts for this template -->
    <script src="../js/agency.min.js"></script>
    <script src="../jquery-easing/jquery.easing.min.js"></script>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>


</body>

<!----------------------------------------------------- /BODY ----------------------------------------------------------->

</html>
